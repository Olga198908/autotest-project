## **Инструкция работы с `git`**

#### **0. Подготовка**
#### **0. Подготовка**
* [Скачать `git`](https://git-scm.com/downloads)
  * [Инструкция установки и эксплуатации `git` глава 4.5](https://disk.yandex.ru/i/p6A-v9AiGy5qxA)
    * После установки, перезапустите терминалы\IDE, если те были включены, `git` в них работать не будет.
* Далее в вашей среде или `IDE`:
  * Вы уже создали проект\директорию, настроили виртуальное окружение вашего языка. Проект лучше назвать аналогично наименованию репозитория.
  * Следующая инструкция подходит для работы в терминале (cmd\unix) из директории проекта (cd...), или из терминала IDE с открытым проектом.

#### **1. Клонирование удаленного репозитория**
* В интерфейсе репозиториев обычно есть кнопка `сlone`, откроется окошко с полем `HTTP`, его содержимое это ваша ссылка для клонирования.
* ВНИМАНИЕ, папка должна быть пустой, папки .idea и .venv временно перенесите куда-нибудь, потом верните.
* Если хотите потом скачать всё командой `git pull` (это пункт 8 ниже) то пропускайте этот этап.
```
git clone https://адресс/testproject.git .
```
* Скачивает удалённый репозиторий с `bitbucket` в текущую папку.
  * Точка в конце указывает на то, что содержимое репозитория будет скачиваться не в отдельную папку, а непосредственно в вашу директорию.
  * Уберите точку в конце если хотите скачать папку (отдельную) с содержимым репозитория.
* Автоматически создаёт подключение к удалённому репозиторию `origin` (т.е. тоже что и команда `git remote add origin`).
  * Так же создаёт папку `.git/` с конфигами `git`. (т.е. тоже что и команда `git init`).
* Если репозиторий приватный, запросит пароль, т.е. запросит (при вводе пароля в терминале ничего не печатается, это нормально, так и должно быть, продолжайте вводить и жмите `enter`)

#### **2. Инициализация нового репозитория**
* Создаёт новый локальный репозиторий `git` в текущей папке (с подпапкой `.git/` в главной директории).
* ВНИМАНИЕ! Если вы сделали `git clone`, эта команда не нужна (и даже вредна — может перезаписать настройки).
```
git init
```

#### **3. Настройка глобальных параметров**
* Настройка имени в `git`, --global
```
git config user.name "имя"
```
* Настройка почты в `git`
```
git config user.email "почта"
```
* Проверить настройки:
```
git config --list
```
* Команды задают имя и почту пользователя в этом проекте.
  * Добавьте `--global` после `config` чтобы задать их для всех репозиториев на этом компьютере.
  * На всякий случай глобальное имя и почту лучше сразу задайте, с ними `git` работает стабильнее.
  * Локальные данные подтягиваются в приоритете.
* Эти данные будут привязываться к вашим коммитам.
  * Без них `git` откажется работать (например, при попытке сделать `git commit`) и будет ругаться ошибкой `Please tell me who you are...`
* Где сохраняется: 
  * Глобальный: Файл ~/.gitconfig (Linux/macOS) и C:\Users\ВашПользователь\.gitconfig (Windows).
  * Локальный: Файл .git/config в папке текущего репозитория.

#### **4. Подключение удалённого репозитория**
* ВНИМАНИЕ! ЭТО ЛИШНЕЕ если делали `git clone`
* Связывает локальный репозиторий с удалённым (даёт ему псевдоним `origin`).
```
git remote add origin https://адресс/testproject.git
```
* После `git clone` это подключение уже есть. Повторная команда может вызвать ошибку.
* Исправление (если URL изменился):
```
git remote set-url origin https://адресс.git
```

#### **5. Добавление файлов в индекс**
* Помечает все изменённые/новые файлы для последующего коммита.
```
git add --all
```
* Альтернативы:
* Добавляет все файлы, кроме удалённых:
```
git add .
```
* Добавляет конкретный файл:
```
git add file.txt
```

#### **6. Создание коммита**
* Фиксирует изменения в локальном репозитории с комментарием.
````
git commit -m "Краткое описание изменений"
````
* Без `-m` откроется редактор (Vim/Nano) для ввода сообщения.
* Важно: Коммит сохраняется только локально (на сервер ничего не уходит).

#### **7. Отправка изменений на сервер**
* Отправляет локальные коммиты из ветки master на сервер `origin`.
```
git push -u origin master
```
* Флаг `-u` запоминает связь веток, чтобы в будущем можно было писать просто `git push`.
* Если ветки нет локально, будет ошибка `src refspec master does not match any`.
* Если на сервере нужна другая ветка, например `dev`, используйте измененную команду:
```
git push -u origin dev
```

#### **8. Обновление локальных данных до актуальных на сервере**
* Чтобы синхронизировать локальную копию с удалённым репозиторием, используйте:
```
git pull origin master
```
* Скачивает изменения с сервера (fetch).
* Объединяет (merge) их с вашей локальной версией.

#### **9. Удаление папки или файлов из репозитория**
* Если вы случайно закоммитили папку или файл, вот как удалить:
* Добавьте файл/папку в .gitignore (если нужно игнорировать в будущем)
```
# Для файла
echo "filename.txt" >> .gitignore
# Для папки (со всем содержимым)
echo "folder_name/" >> .gitignore
```
* Удалите файл/папку из индекса Git (оставив на диске)
```
# Для файла
git rm --cached path/to/filename.txt
# Для папки (рекурсивно)
git rm -r --cached path/to/folder_name/
```
* Флаг --cached удаляет объект только из Git, но не с вашего компьютера.
* Если нужно удалить и с диска, уберите --cached, например:
```
git rm path/to/file.txt
```
* Зафиксируйте изменения
```
# Индексим
git add .
# Комитим
git commit -m "Удаление filename.txt и folder_name"
# Пушим
git push origin branch_name
```

#### **10. Полезные команды `git`**
```
# Основные команды
git status                              Показывает изменённые/неотслеживаемые файлы
git log --oneline --graph               Краткая история коммитов
git diff                                Показывает изменения в файлах	
git fetch --all	                        Скачивает изменения с сервера без слияния
git restore <file>                      Отменяет изменения в файле
git branch -a	                        Показывает все ветки (локальные и удалённые)

# Ветки (Branches)
git branch -v                           Список локальных веток
git checkout -b <branch>                Создаёт и переключается на ветку
git merge <branch>                      Вливает ветку в текущую
git rebase <branch>                     Перемещает коммиты на вершину ветки	(использовать осторожно!)

# Работа с удалённым репозиторием
git remote -v                           Показывает подключённые удалённые репозитории
git push -u origin <branch>             Отправляет ветку на сервер
git pull --rebase                       Обновляет ветку с перебазированием
git fetch --prune                       Удаляет локальные ссылки на удалённые

# Отмена изменений
git reset --soft HEAD~1                 Отменяет коммит, оставляя изменения в индексе
git reset --hard HEAD~1                 Полная отмена коммита и изменений (осторожно!)
git revert <commit-hash>                Создаёт новый коммит, отменяющий изменения

# Поиск и исправление
git grep "текст"                        Поиск текста в файлах репозитория
git bisect                              Бинарный поиск коммита с ошибкой
git stash                               Временно сохраняет изменения

# Для продвинутых
git reflog                              Показывает историю всех действий (спасёт при ошибках)
git cherry-pick <commit>                Копирует коммит из другой ветки
git submodule update --init             Инициализирует подмодули
```

## **Проблемы и ошибки `git`**
### **Аутентификация**
* Если возникают проблемы с аутентификацией, например в `github`, выдавая ошибку `fatal: unable to access 'ССЫЛКАнаРЕПОЗИТОРИЙ': The requested URL returned error: 403`, то поможет прямое указание ветки при пуше:
```
git push https://НикГитхаб@github.com/НикГитхаб/ИмяРепозитория.git main
```
* Старые учетные данные (в windows) трутся так:
1. "Панель управления" → "Диспетчер учётных данных" (Можно через поиск найти)
2. Нажмите "Учетные данные Windows"
3. Удалите всё что связанно с гитхабом
### **Push**
* Если ваш локальный main отстаёт от удалённого (origin/main), и Git отклоняет push для предотвращения потери изменений, выдавая ошибку `error: failed to push some refs to 'ССЫЛКАнаРЕПОЗИТОРИЙ'`. Вот как это исправить:
```
git pull origin main                            # сначала получаем изменения с сервера
git push origin main                            # затем пушим свои изменения
```
* Принудительный push (только если вы уверены)
```
git push --force origin main
```
* Перебазирование (для сложных случаев)
```
git pull --rebase origin main                   # "перемещает" ваши коммиты поверх новых изменений
```
* Если выходит ошибка `error: Your local changes to 'file.txt' would be overwritten by merge.` значит есть незакоммиченные изменения, которые конфликтуют с pull.
```
git stash                                       # временно сохранить изменения
git pull                                        # обновиться с сервера
git stash pop                                   # вернуть изменения
```
### **Адреса**
* Если сменился адрес и при команде push выходит ошибка вида `ERROR: Repository not found.` и `fatal: Could not read from remote repository.` или `fatal: unable to access 'https://old-url.com/repo.git/': Could not resolve host: old-url.com` то нужно скорректировать адрес репозитория командой:
```
git remote -v                                   # проверить текущий URL
git remote set-url origin URL-HTTP-или-SSH      # сменить URL
```
### **Ветки**
* Бывает ошибка `error: src refspec main does not match any`, что Git не может найти локальную ветку main, которую вы пытаетесь отправить (push) на удалённый репозиторий (origin).
* Если нужно переименовать ветку (локально):
```
git branch -m master main                       # заменит master на main
```
### **Клонирование**
* Если при клонировании репозитория вылазит ошибка `fatal: destination path '.' already exists and is not an empty directory.`, значит вы пытаетесь клонировать не в пустую папку. Очистите главную директорию, и повторите. Или воспользуйтесь командами для зачистки директории (ОСТОРОЖНО! Выполняйте внимательно):
```
rm -rf * .* 2>/dev/null                         # Linux/macOS
ИЛИ
Remove-Item * -Recurse -Force                   # Windows PowerShell
```
### **Конфигурация**
* Ошибка: `Please tell me who you are` это значит забыли первично настроить `git`, решаем:
```
git config --global user.email "you@example.com"
И
git config --global user.name "Your Name"
```
* Ошибка: `LF will be replaced by CRLF` это конфликт переносов строк (Windows vs Unix), решаем:
```
git config --global core.autocrlf true          # для Windows
ИЛИ
git config --global core.autocrlf input         # для Linux/macOS
```
* Ошибка: `Detached HEAD` это значит вы баловались и переключились на какой-то конкретный коммит, решаем:
```
git checkout master                             # возврат на ветку
ИЛИ
git checkout -b new-branch                      # создать новую ветку из этого состояния
```

## **Особенности `git`**
### **.gitignore**
* В основной директории проекта должен быть файл `.gitignore`, он служит для указания `git`'у на файлы и директории которые ему следует не замечать.
* Выглядеть он может так:
```
__pycache__/                                    # игнор кэша пайтона
*.py[cod]                                       # игнор всех файлов пайтона с расширенями .pyc .pyo .pyd
*.exe                                           # игнор всех файлов с расширением .exe
.env                                            # игнор папки файлов окружения (дефолтное название)
.venv/                                          # игнор папки виртуального окружения пайтон (дефолтное название)
```
* Проверка игнора:
```
git check-ignore -v path/to/file
```